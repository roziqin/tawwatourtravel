!function(t){"use strict";function a(a){a.find(".tourmaster-review-form-rating, .tourmaster-tour-search-field-rating").each(function(){t(this).children(".tourmaster-rating-select").click(function(){t(this).siblings("input").val(t(this).attr("data-rating-score")),t(this).is("i")&&t(this).removeClass().addClass("tourmaster-rating-select fa fa-star-half-empty"),t(this).prevAll("i").removeClass().addClass("tourmaster-rating-select fa fa-star"),t(this).nextAll("i").removeClass().addClass("tourmaster-rating-select fa fa-star-o")})})}function e(e,i){var o=t('<div class="tourmaster-admin-lightbox-wrapper" ></div>').hide(),s=t('<div class="tourmaster-admin-lightbox-content-cell" ></div>');o.append(s),s.wrap(t('<div class="tourmaster-admin-lightbox-content-row" ></div>')),s.append(e),t("body").append(o),o.fadeIn(300),a(o),o.find(".tourmaster-html-option-datepicker").each(function(){t(this).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})}),o.on("click",".tourmaster-admin-lightbox-close",function(){o.fadeOut(300,function(){t(this).remove()})}),o.on("click",".tourmaster-submit-review",function(){var a=t(this);a.addClass("tourmaster-now-loading");var e=new Object;t(this).closest(".tourmaster-review-form").find("[name]").each(function(){"review_action"==t(this).attr("name")?e.action=t(this).val():e[t(this).attr("name")]=t(this).val()}),t.ajax({type:"POST",url:a.attr("data-ajax-url"),data:e,dataType:"json",error:function(t,e,i){a.removeClass("tourmaster-now-loading"),console.log(t,e,i)},success:function(e){a.removeClass("tourmaster-now-loading"),void 0===e.status||(e.status,0)||tourmaster_alert_box({status:e.status,message:e.message}),"success"==e.status&&i.trigger("change"),o.fadeOut(300,function(){t(this).remove()})}})})}function i(){var i=t("#tourmaster-review-option");i.length&&(a(i),i.on("click",".tourmaster-single-review-edit",function(){if(!t(this).hasClass("tourmaster-active")){t(this).addClass("tourmaster-active");var a=t(this),o=t(this).closest(".tourmaster-html-option-admin-manage-review"),s=t('<div class="tourmaster-single-review-edit-loading" ></div>').css("display","none");t("body").append(s),s.fadeIn(200),t.ajax({type:"POST",url:o.attr("data-ajax-url"),data:{action:"tourmaster_get_edit_admin_review_item",review_id:a.attr("data-id")},dataType:"json",error:function(e,i,o){a.removeClass("tourmaster-active"),s.fadeOut(200,function(){t(this).remove()}),console.log(e,i,o)},success:function(o){a.removeClass("tourmaster-active"),s.fadeOut(200,function(){t(this).remove()}),void 0!==o.content?e(o.content,i):void 0!==o.status&&void 0!==o.message&&tourmaster_alert_box({status:o.status,message:o.message})}})}}),i.on("click",".tourmaster-single-review-remove",function(){var a=t(this),e=t(this).closest(".tourmaster-html-option-admin-manage-review");tourmaster_confirm_box({success:function(){t.ajax({type:"POST",url:e.attr("data-ajax-url"),data:{action:"tourmaster_remove_admin_review_item",review_id:a.attr("data-id")},dataType:"json",error:function(t,a,e){console.log(t,a,e)},success:function(t){}}),a.closest(".tourmaster-single-review-content-item").slideUp(200,function(){t(this).remove()})}})}),i.change(function(){var a=t(this).find(".tourmaster-html-option-admin-manage-review");a.slideUp(200),t.ajax({type:"POST",url:a.attr("data-ajax-url"),data:{action:"tourmaster_get_admin_review_item",tour_id:a.attr("data-tour-id"),paged:1},dataType:"json",error:function(t,a,e){console.log(t,a,e)},success:function(t){void 0!==t.content?a.html(t.content).slideDown():void 0!==t.status&&void 0!==t.message&&tourmaster_alert_box({status:t.status,message:t.message})}})}),i.on("click",".tourmaster-review-content-pagination span",function(){var a=t(this).closest(".tourmaster-html-option-admin-manage-review");a.slideUp(200),t.ajax({type:"POST",url:a.attr("data-ajax-url"),data:{action:"tourmaster_get_admin_review_item",tour_id:a.attr("data-tour-id"),paged:t(this).attr("data-paged")},dataType:"json",error:function(t,a,e){console.log(t,a,e)},success:function(t){void 0!==t.content?a.html(t.content).slideDown():void 0!==t.status&&void 0!==t.message&&tourmaster_alert_box({status:t.status,message:t.message})}})}),i.on("click",".tourmaster-submit-review",function(){var a=t(this);a.addClass("tourmaster-now-loading");var e=new Object;t(this).closest(".tourmaster-review-form").find("[name]").each(function(){"review_action"==t(this).attr("name")?e.action=t(this).val():e[t(this).attr("name")]=t(this).val()}),t.ajax({type:"POST",url:a.attr("data-ajax-url"),data:e,dataType:"json",error:function(t,e,i){a.removeClass("tourmaster-now-loading"),console.log(t,e,i)},success:function(t){a.removeClass("tourmaster-now-loading"),void 0!==t.status&&void 0!==t.message&&tourmaster_alert_box({status:t.status,message:t.message}),"success"==t.status&&i.trigger("change")}})}))}t(document).ready(function(){t(".tourmaster-page-option-content").each(function(){var a=t(this).siblings(".tourmaster-page-option-value"),e=new tourmasterHtmlOption(t(this));t("#post-preview, #publish, #save-post").click(function(){a.val(JSON.stringify(e.get_val()))});var i=t(this).find("#tourmaster-page-option-tab-head"),o=t(this).find("#tourmaster-page-option-tab-content");i.children(".tourmaster-page-option-tab-head-item").click(function(){if(!t(this).hasClass("tourmaster-active")){var a=t(this).attr("data-tab-slug");t(this).addClass("tourmaster-active").siblings().removeClass("tourmaster-active"),o.find('[data-tab-slug="'+a+'"]').fadeIn(200).siblings().css("display","none")}})}),t("#edittag, #addtag").each(function(){new tourmasterHtmlOption(t(this))}),i()})}(jQuery),function(t){"use strict";window.tourmasterHtmlOption=function(a){this.container=t(a),this.init()},tourmasterHtmlOption.prototype={init:function(){this.bind_input_format(),this.bind_input_time(),this.bind_image_uploader(),this.bind_conditional(),this.bind_button_action(),this.rebind()},rebind:function(){var o=this;o.container.find(".tourmaster-html-option-colorpicker").wpColorPicker(),o.init_conditional(),o.bind_import(),o.bind_export(),o.bind_datepicker(),o.bind_font_slider(),o.container.find('[data-type="custom"]').each(function(){var o=t(this).children(".tourmaster-html-option-custom-value").data("value"),s=t(this).children(".tourmaster-html-option-custom-options").data("value"),n=t(this).children(".tourmaster-html-option-custom-settings").data("value");o&&t(this).data("value",o),s&&t(this).data("options",s),n&&t(this).data("settings",n),t(this).is('[data-item-type="tabs"]')?new a(t(this)):t(this).is('[data-item-type="gallery"]')?new e(t(this)):t(this).is('[data-item-type="group-discount"]')&&new i(t(this))})},get_val:function(){var a={};return this.container.find("[data-slug]").each(function(){var e=t(this).attr("data-slug"),i=t(this).attr("data-type");"text"==i||"textarea"==i||"combobox"==i||"upload"==i||"colorpicker"==i||"font"==i||"multi-combobox"==i?a[e]=t(this).val():"checkbox"==i?a[e]=t(this).is(":checked")?"enable":"disable":"radioimage"==i?t(this).is(":checked")&&(a[e]=t(this).val()):"custom"==i&&(a[e]=t(this).data("value"))}),a},init_conditional:function(){this.container.find("[data-condition]").each(function(){var a=t(this).closest(".tourmaster-condition-wrapper"),e=JSON.parse(t(this).attr("data-condition")),i=!0;for(var o in e){var s=a.find('[data-slug="'+o+'"], [data-tabs-slug="'+o+'"]'),n="";n=s.is('input[type="checkbox"]')?s.is(":checked")?"enable":"disable":s.is('input[type="radio"]')?s.filter(":checked").val():s.val(),"css-condition"==e[o]?t(this).attr("data-"+o,n):i=i&&(n==e[o]||e[o].constructor===Array&&-1!=e[o].indexOf(n))}i?t(this).show():t(this).hide()})},bind_conditional:function(){this.container.on("change",'select, input[type="checkbox"], input[type="radio"]',function(){var a=t(this).closest(".tourmaster-condition-wrapper");a.find("[data-condition]").each(function(){var e=JSON.parse(t(this).attr("data-condition")),i=!0;for(var o in e){var s=a.find('[data-slug="'+o+'"], [data-tabs-slug="'+o+'"]'),n="";n=s.is('input[type="checkbox"]')?s.is(":checked")?"enable":"disable":s.is('input[type="radio"]')?s.filter(":checked").val():s.val(),"css-condition"==e[o]?t(this).attr("data-"+o,n):i=i&&(n==e[o]||e[o].constructor===Array&&-1!=e[o].indexOf(n))}i?t(this).slideDown(200):"none"==t(this).css("display")?t(this).hide():t(this).slideUp(200)})})},bind_input_format:function(){this.container.on("change","input[data-input-type]",function(){var a=t(this).val().match(/^-?\d+/g),e="";"pixel"==t(this).attr("data-input-type")&&(e="px"),void 0!==a&&null!=a&&t(this).val(parseInt(a[0])+e),t(this).trigger("tourmaster_change")}),this.container.on("keydown","input[data-input-type]",function(a){var e=a.keyCode?a.keyCode:a.which;if(40==e||38==e){var i=t(this).val().match(/^-?\d+/g),o="";"pixel"==t(this).attr("data-input-type")&&(o="px"),void 0!==i&&null!=i&&(40==e?t(this).val(parseInt(i[0])-1+o):38==e&&t(this).val(parseInt(i[0])+1+o),t(this).trigger("tourmaster_change"))}})},bind_input_time:function(){this.container.on("change",".tourmaster-html-option-time",function(){var a=t(this).siblings('input[type="hidden"]'),e=a.siblings(".tourmaster-input-hh"),i=a.siblings(".tourmaster-input-mm");e.val()||i.val()?a.val(("00"+e.val()).slice(-2)+":"+("00"+i.val()).slice(-2)):a.val(""),a.trigger("change")})},bind_image_uploader:function(){this.container.on("click",".tourmaster-upload-image-button",function(){var a=t(this).closest(".tourmaster-html-option-upload-appearance"),e=a.children(".tourmaster-upload-image-container"),i=a.children(".tourmaster-html-option-upload"),o=a.children(".tourmaster-html-option-upload-image");if(t(this).hasClass("tourmaster-upload-image-add"))var s=wp.media({title:html_option_val.text.upload_media,button:{text:html_option_val.text.choose_media},multiple:!1}).on("select",function(){var t=s.state().get("selection").first().toJSON();a.addClass("tourmaster-active"),e.css("background-image","url("+t.url+")"),i.val(t.id),o.val(t.url),i.trigger("change")}).open();else t(this).hasClass("tourmaster-upload-image-remove")&&(a.removeClass("tourmaster-active"),e.css("background-image",""),i.val(""),o.val(""),i.trigger("change"))})},bind_datepicker:function(){this.container.find(".tourmaster-html-option-datepicker").each(function(){t(this).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})})},bind_button_action:function(){var a=this;a.container.on("click",".tourmaster-html-option-button",function(){if(!t(this).hasClass("tourmaster-now-loading")){var e=t(this);tourmaster_confirm_box({success:function(){if("ajax"==e.attr("data-type")){var t=e.closest(".tourmaster-condition-wrapper"),i=e.attr("data-ajax-url"),o={action:e.attr("data-action"),post_id:e.attr("data-post-id")},s=e.data("fields");if(void 0!==s&&s instanceof Array)for(var n in s){var r=t.find('[data-slug="'+s[n]+'"]');r.is('input[type="checkbox"]')?o[s[n]]=r.is(":checked")?"enable":"disable":o[s[n]]=r.val()}a.button_ajax_action(e,i,o)}}})}})},button_ajax_action:function(a,e,i){t.ajax({type:"POST",url:e,data:i,dataType:"json",beforeSend:function(t,e){a.addClass("tourmaster-now-loading")},error:function(t,e,i){a.removeClass("tourmaster-now-loading"),console.log(t,e,i)},success:function(t){a.removeClass("tourmaster-now-loading"),void 0!==t.status&&void 0!==t.message&&tourmaster_alert_box({status:t.status,message:t.message})}})},bind_font_slider:function(){this.container.find(".tourmaster-html-option-fontslider").each(function(){var a=t(this),e=t('<div class="tourmaster-html-option-fontslider-appearance" ></div>'),i=t(this).attr("data-min-value")?parseInt(t(this).attr("data-min-value")):6,o=t(this).attr("data-max-value")?parseInt(t(this).attr("data-max-value")):160,s=t(this).attr("data-suffix")?t(this).attr("data-suffix"):"px";"none"==s&&(s=""),e.insertBefore(t(this)),e.slider({range:"min",min:i,max:o,value:parseInt(a.val()),slide:function(t,e){a.val(e.value+s)}}),a.val(parseInt(a.val())+s),t(this).on("input change",function(){e.slider("value",parseInt(a.val()))})})},bind_import:function(){this.container.find(".tourmaster-html-option-import").each(function(){var a=t(this).find("form"),e=t(this).find(".tourmaster-html-option-import-file");t(this).find(".tourmaster-html-option-import-button").click(function(){return e.val().length>0?tourmaster_confirm_box({success:function(){a.submit()}}):tourmaster_alert_box({status:"failed",head:"File not found",message:"Please select the file before importing"}),!1})})},bind_export:function(){this.container.find(".tourmaster-html-option-export").each(function(){var a=t(this),e=a.find(".tourmaster-html-option-export-button");e.click(function(){var i={action:a.attr("data-action"),security:html_option_val.text.nonce};a.find(".tourmaster-html-option-export-option").each(function(){i.options=t(this).val()}),t.ajax({type:"POST",url:html_option_val.text.ajaxurl,data:i,dataType:"json",beforeSend:function(t,a){e.addClass("tourmaster-now-loading")},error:function(t,a,e){tourmaster_alert_box({status:"failed",head:html_option_val.text.error_head,message:html_option_val.text.error_message}),console.log(t,a,e)},success:function(t){e.removeClass("tourmaster-now-loading"),"success"==t.status?tourmaster_download_file(t.url,t.filename):"success-2"==t.status?tourmaster_download_content(t.content,t.filename):"failed"==t.status&&tourmaster_alert_box({status:t.status,head:t.head,message:t.message})}})})})}};var a=function(a){var e=this;e.container=a,e.values=a.data("value"),e.tabs_container=t('<div class="tourmaster-html-option-tabs-container" ></div>'),e.add_button=t('<div class="tourmaster-html-option-tabs-add"></div>'),e.template={title:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title tourmaster-html-option-title-item" ></span>\t\t\t</div>',description:'<div class="tourmaster-html-option-tabs-field tourmaster-html-option-tabs-field-description clearfix" >\t\t\t</div>',text:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<input type="text" class="tourmaster-html-option-tabs-input tourmaster-html-option-text" data-tabs-slug="" >\t\t\t</div>',time:'<div class="tourmaster-html-option-tabs-field tourmaster-html-option-tabs-field-time clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<input type="text" class="tourmaster-html-option-time tourmaster-input-hh" placeholder="HH" />\t\t\t\t<span class="tourmaster-html-option-time-sep" >:</span>\t\t\t\t<input type="text" class="tourmaster-html-option-time tourmaster-input-mm" placeholder="MM" />\t\t\t\t<input type="hidden" data-tabs-slug="" data-template-type="time" />\t\t\t</div>',tabs:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-inner-tab-title" ></span>\t\t\t\t<div class="tourmaster-html-option-tabs-field-tab" data-tabs-slug="" ></div>\t\t\t</div>',datepicker:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<input type="text" class="tourmaster-html-option-tabs-input tourmaster-html-option-text tourmaster-html-option-datepicker" data-tabs-slug="" >\t\t\t</div>',textarea:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<textarea class="tourmaster-html-option-tabs-input tourmaster-html-option-textarea" data-tabs-slug="" ></textarea>\t\t\t</div>',combobox:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<div class="tourmaster-custom-combobox" >\t\t\t\t\t<select class="tourmaster-html-option-combobox" data-type="combobox" data-tabs-slug="" ></select>\t\t\t\t</div>\t\t\t</div>',radioimage:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t</div>',colorpicker:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<input type="text" class="tourmaster-html-option-tabs-colorpicker tourmaster-html-option-colorpicker" data-tabs-slug="" >\t\t\t</div>',checkbox:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<label>\t\t\t\t\t<input type="checkbox" class="tourmaster-html-option-checkbox" data-tabs-slug="" checked="checked" style="display: none;">\t\t\t\t\t<div class="tourmaster-html-option-checkbox-appearance tourmaster-noselect">\t\t\t\t\t\t<span class="tourmaster-checkbox-button tourmaster-on">'+html_option_val.tabs.tab_checkbox_on+'</span>\t\t\t\t\t\t<span class="tourmaster-checkbox-separator"></span>\t\t\t\t\t\t<span class="tourmaster-checkbox-button tourmaster-off">'+html_option_val.tabs.tab_checkbox_off+"</span>\t\t\t\t\t</div>\t\t\t\t</label>\t\t\t</div>",checkboxes:'<div class="tourmaster-html-option-tabs-field tourmaster-html-option-tabs-checkboxes clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<div class="tourmaster-html-option-tabs-content clearfix"></div>\t\t\t</div>',upload:'<div class="tourmaster-html-option-tabs-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-tabs-input-title" ></span>\t\t\t\t<div class="tourmaster-html-option-upload-appearance" >\t\t\t\t\t<input type="hidden" class="tourmaster-html-option-upload" data-type="upload" data-tabs-slug="" />\t\t\t\t\t<input type="hidden" class="tourmaster-html-option-upload-image" data-type="upload-img" data-tabs-slug="" />\t\t\t\t\t<div class="tourmaster-upload-image-container" style="" ></div>\t\t\t\t\t<div class="tourmaster-upload-image-overlay" >\t\t\t\t\t\t<div class="tourmaster-upload-image-button-hover">\t\t\t\t\t\t\t<span class="tourmaster-upload-image-button tourmaster-upload-image-add"><i class="icon_plus" ></i></span>\t\t\t\t\t\t\t<span class="tourmaster-upload-image-button tourmaster-upload-image-remove"><i class="icon_minus-06" ></i></span>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>'};var i=html_option_val.tabs.title_text,o=a.data("settings");void 0!==o&&void 0!==o["tab-title"]&&(i=o["tab-title"]),e.item_template=t('<div class="tourmaster-html-option-tabs-template tourmaster-condition-wrapper" >\t\t\t\t<div class="tourmaster-html-option-tabs-template-title" >\t\t\t\t\t<span class="tourmaster-head" >'+i+'</span>\t\t\t\t\t<div class="tourmaster-html-option-tabs-remove"></div>\t\t\t\t</div>\t\t\t</div>');var s=a.data("options"),n=t('<div class="tourmaster-html-option-tabs-template-content" ></div>');for(var r in s){var l=t(e.template[s[r].type]);if(l.find("[data-tabs-slug]").each(function(){if(void 0!==s[r]["data-input-type"]&&t(this).attr("data-input-type",s[r]["data-input-type"]),"upload-img"==t(this).attr("data-type"))t(this).attr("data-tabs-slug",r+"-img");else if(t(this).attr("data-tabs-slug",r),"combobox"==t(this).attr("data-type")&&void 0!==s[r].options)for(var a in s[r].options){var e=t("<option></option>").attr("value",a).html(s[r].options[a]);t(this).append(e)}}),"radioimage"==s[r].type&&void 0!==s[r].options){var d="";for(var c in s[r].options){var u=t('<label class="tourmaster-html-option-tabs-radioimage" ></label>');u.append(t('<input class="tourmaster-html-option-radioimage" type="radio" data-type="radioimage" />').attr("name",r).attr("data-tabs-slug",r).attr("value",c)),u.append('<div class="tourmaster-radioimage-checked"></div>'),u.append(t('<img alt="" />').attr("src",s[r].options[c])),""!=d&&d!=c||(d=c,u.find('input[type="radio"]').prop("checked",!0)),l.append(u)}}else if("checkboxes"==s[r].type&&void 0!==s[r].options)for(var c in s[r].options)if("select-all"==c){var p='<span class="tourmaster-html-option-checkboxes-selected" >(\t\t\t\t\t\t\t<span class="tourmaster-select-all" >'+s[r].options["select-all"]+'</span>\t\t\t\t\t\t\t<span class="tourmaster-separator" >/</span>\t\t\t\t\t\t\t<span class="tourmaster-deselect-all" >'+s[r].options["deselect-all"]+"</span>\t\t\t\t\t\t\t)</span>";l.children(".tourmaster-html-option-tabs-content").append(p)}else if("deselect-all"==c);else{var m=t("<label></label>");m.append(t('<input type="checkbox" class="tourmaster-html-option-checkboxes" >').attr("data-tabs-slug",r).attr("value",c)),m.append(s[r].options[c]),l.children(".tourmaster-html-option-tabs-content").append(m)}else"tabs"==s[r].type&&(l.find(".tourmaster-html-option-tabs-field-tab").data("options",s[r].options),s[r].settings&&l.find(".tourmaster-html-option-tabs-field-tab").data("settings",s[r].settings));l.find(".tourmaster-html-option-tabs-input-title, .tourmaster-html-option-tabs-inner-tab-title").html(s[r].title),void 0!==s[r].title_color&&l.find(".tourmaster-html-option-tabs-input-title").css("color",s[r].title_color),void 0!==s[r].wrapper_class&&l.addClass(s[r].wrapper_class),l.attr("data-wrapper-slug",r),void 0!==s[r].condition&&l.attr("data-condition",JSON.stringify(s[r].condition)),void 0!==s[r].description&&l.append(t('<div class="tourmaster-html-option-tabs-input-description" ></div>').html(s[r].description)),n.append(l)}e.item_template.append(n),e.init()};a.prototype={init:function(){var e=this;if(e.container.append(e.tabs_container),e.container.closest(".tourmaster-html-option-item-input").siblings(".tourmaster-html-option-item-title").append(e.add_button),e.container.siblings(".tourmaster-html-option-tabs-inner-tab-title").append(e.add_button),e.values&&e.values.length>0){for(var i in e.values)e.tabs_container.append(e.get_template(e.values[i]));e.tabs_container.find(".tourmaster-html-option-colorpicker").wpColorPicker({change:tourmaster_debounce(function(t,a){e.update_data()},500)}),e.tabs_container.find(".tourmaster-html-option-datepicker").each(function(){t(this).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})});var o=e.tabs_container.find(".tourmaster-html-option-tabs-field-tab");o.length&&new a(o),e.tabs_container.find('select, input[type="checkbox"], input[type="radio"]').trigger("change")}e.tabs_container.sortable({tolerance:"pointer",delay:150,stop:function(t,a){e.update_data()}}),e.bind_add(),e.container.on("click",".tourmaster-html-option-tabs-remove",function(){t(this).closest(".tourmaster-html-option-tabs-template").slideUp(200,function(){e.is_inner_tab_element(t(this))||(t(this).remove(),e.update_data())})}),e.container.on("click",".tourmaster-html-option-tabs-template-title",function(){e.is_inner_tab_element(t(this))||t(this).siblings(".tourmaster-html-option-tabs-template-content").slideToggle(200)}),e.container.on("click",".tourmaster-select-all, .tourmaster-deselect-all",function(){if(!e.is_inner_tab_element(t(this))){var a=t(this).closest(".tourmaster-html-option-tabs-content");t(this).hasClass("tourmaster-select-all")?a.find('input[type="checkbox"]').prop("checked",!0):a.find('input[type="checkbox"]').prop("checked",!1)}}),e.container.on("change tourmaster_change",'input[type="text"], textarea',function(){e.is_inner_tab_element(t(this))||("title"==t(this).attr("data-tabs-slug")&&t(this).closest(".tourmaster-html-option-tabs-template-content").siblings(".tourmaster-html-option-tabs-template-title").children(".tourmaster-head").html(t(this).val()),e.update_data())}),e.container.on("change",'input[type="checkbox"], input[type="radio"], input[type="hidden"]',function(){e.is_inner_tab_element(t(this))||e.update_data()}),e.container.on("tourmaster_change",".tourmaster-html-option-tabs-field-tab",function(){e.is_inner_tab_element(t(this))||e.update_data()})},bind_add:function(){var e=this;e.add_button.click(function(){var i=e.get_template();e.tabs_container.append(i),i.find(".tourmaster-html-option-colorpicker").wpColorPicker({change:tourmaster_debounce(function(t,a){e.update_data()},500)}),i.find(".tourmaster-html-option-datepicker").each(function(){t(this).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})});var o=i.find(".tourmaster-html-option-tabs-field-tab");o.length&&new a(o),i.find('select, input[type="checkbox"], input[type="radio"]').trigger("change"),i.find(".tourmaster-html-option-tabs-template-content").css({display:"block"}),i.css({display:"none"}).slideDown(200),e.update_data()})},get_template:function(a){var e=this,i=e.item_template.clone(!0);for(var o in a){i.find('[data-tabs-slug="'+o+'"]').each(function(){if(t(this).is('input[type="checkbox"]'))t(this).is(".tourmaster-html-option-checkboxes")?a[o].indexOf(t(this).val())>=0&&t(this).prop("checked",!0):"enable"==a[o]?t(this).prop("checked",!0):t(this).prop("checked",!1);else if(t(this).is('input[type="radio"]'))a[o]==t(this).val()?t(this).prop("checked",!0):t(this).prop("checked",!1);else if("upload-img"==t(this).attr("data-type"))t(this).val(a[o]),t(this).closest(".tourmaster-html-option-upload-appearance").addClass("tourmaster-active"),t(this).siblings(".tourmaster-upload-image-container").css("background-image","url("+a[o]+")");else if(t(this).is(".tourmaster-html-option-tabs-field-tab"))t(this).data("value",a[o]);else if(t(this).val(a[o]),"time"==t(this).attr("data-template-type")){var e=a[o].split(":");void 0!==e[0]&&void 0!==e[1]&&(t(this).siblings(".tourmaster-input-hh").val(e[0]),t(this).siblings(".tourmaster-input-mm").val(e[1]))}});var s=i.children(".tourmaster-html-option-tabs-field-tab");s.length&&s.data("value",a[o]),"title"==o&&""!=a[o]&&i.find(".tourmaster-html-option-tabs-template-title").children(".tourmaster-head").html(a[o])}var n=e.tabs_container.children().length;return i.find('input[type="radio"]').each(function(){t(this).attr("name",t(this).attr("name")+"-"+n)}),i},is_inner_tab_element:function(t){return!this.container.is(".tourmaster-html-option-tabs-field-tab")&&!t.is(".tourmaster-html-option-tabs-field-tab")&&t.closest(".tourmaster-html-option-tabs-field-tab").length>0},update_data:function(){var a=this;a.values=[],a.tabs_container.children(".tourmaster-html-option-tabs-template").each(function(){var e={};t(this).find("[data-tabs-slug]").each(function(){a.is_inner_tab_element(t(this))||(t(this).is(".tourmaster-html-option-tabs-field-tab")?e[t(this).attr("data-tabs-slug")]=t(this).data("value"):t(this).is('input[type="checkbox"]')?t(this).is(".tourmaster-html-option-checkboxes")?("object"!=typeof e[t(this).attr("data-tabs-slug")]&&(e[t(this).attr("data-tabs-slug")]=[]),t(this).is(":checked")&&e[t(this).attr("data-tabs-slug")].push(t(this).val())):e[t(this).attr("data-tabs-slug")]=t(this).is(":checked")?"enable":"disable":t(this).is('input[type="radio"]')?t(this).is(":checked")&&(e[t(this).attr("data-tabs-slug")]=t(this).val()):e[t(this).attr("data-tabs-slug")]=t(this).val())}),a.values.push(e)}),a.container.data("value",a.values),a.container.trigger("tourmaster_change")}};var e=function(a){var e=this;e.container=a,e.values=a.data("value"),e.options=a.data("options"),e.gallery_container=t('<div class="tourmaster-html-option-gallery-container" ></div>'),e.add_button=t('<div class="tourmaster-html-option-gallery-add" ><i class="icon_plus" ></i></div>'),e.template=t('<div class="tourmaster-html-option-gallery-template">\t\t\t\t<img class="tourmaster-html-option-gallery-template-thumbnail" src="" alt="" /> \t\t\t\t<div class="tourmaster-html-option-gallery-template-remove" ><i class="fa fa-remove" ></i></div>\t\t\t</div>'),e.init()};e.prototype={init:function(){var a=this;a.container.append(a.add_button).append(a.gallery_container);for(var e in a.values)a.add_template(a.values[e]);a.bind_add(),a.bind_gallery_edit(),a.gallery_container.on("click",".tourmaster-html-option-gallery-template-remove",function(){return t(this).closest(".tourmaster-html-option-gallery-template").fadeOut(200,function(){t(this).remove(),a.update_data()}),!1}),a.gallery_container.sortable({tolerance:"pointer",stop:function(t,e){a.update_data()}})},bind_add:function(){var t=this;t.add_button.click(function(){var a=wp.media({title:html_option_val.text.upload_media,button:{text:html_option_val.text.choose_media},multiple:"add"}).on("select",function(){var e=a.state().get("selection").toJSON();for(var i in e){var o=e[i].sizes.full.url;void 0!==e[i].sizes.thumbnail&&(o=e[i].sizes.thumbnail.url),t.add_template({id:e[i].id,thumbnail:o})}t.update_data()}).open()})},bind_gallery_edit:function(){var a=this;a.gallery_container.on("click",".tourmaster-html-option-gallery-template",function(){var e=t(this),i=t('<div class="tourmaster-html-option-gallery-loading" ></div>');t.ajax({type:"POST",url:html_option_val.text.ajaxurl,data:{action:"gdlr_get_gallery_options",security:html_option_val.text.nonce,options:a.options,value:t(this).data("value")},dataType:"json",beforeSend:function(t,a){i.css({display:"none"}).appendTo("body"),i.fadeIn(150)},error:function(t,a,e){tourmaster_alert_box({status:"failed",head:html_option_val.text.error_head,message:html_option_val.text.error_message}),console.log(t,a,e)},success:function(t){i.remove(),"success"==t.status?a.gallery_lb_edit(t.option_content,e):"failed"==t.status&&tourmaster_alert_box({status:t.status,head:t.head,message:t.message})}})})},gallery_lb_edit:function(a,e){var i=this,o=t('<div class="tourmaster-gallery-lightbox-content"></div>');t("body").append(o),o.append(a),o.css({opacity:0}).animate({opacity:1},400);var s=new gdlrCoreHtmlOption(o);o.find("#tourmaster-gallery-lb-head-close").click(function(){o.fadeOut(200,function(){t(this).remove()})}),o.find("#tourmaster-gallery-lb-options-save").click(function(){var a=t.extend(s.get_val(),e.data("value"));e.data("value",a),i.update_data(),o.fadeOut(200,function(){t(this).remove()})})},add_template:function(t){var a=this.template.clone();a.data("value",t),a.find(".tourmaster-html-option-gallery-template-thumbnail").attr("src",t.thumbnail),this.gallery_container.append(a)},update_data:function(){var a=this;a.values=[],a.gallery_container.find(".tourmaster-html-option-gallery-template").each(function(){a.values.push(t(this).data("value"))}),a.container.data("value",a.values)}};var i=function(a){var e=this;e.container=a,e.values=a.data("value"),e.tabs_container=t('<div class="tourmaster-html-option-group-discount-container" ></div>'),e.add_button=t('<div class="tourmaster-html-option-group-discount-add"></div>'),e.template={text:'<div class="tourmaster-html-option-group-discount-field clearfix" >\t\t\t\t<span class="tourmaster-html-option-group-discount-input-title" ></span>\t\t\t\t<input type="text" class="tourmaster-html-option-group-discount-input tourmaster-html-option-text" data-tabs-slug="" >\t\t\t</div>',description:'<div class="tourmaster-html-option-group-discount-description" >\t\t\t</div>'},e.item_template=t('<div class="tourmaster-html-option-group-discount-template" ></div>');var i=a.data("options"),o=t('<div class="tourmaster-html-option-group-discount-template-content clearfix" ></div>');for(var s in i){var n=t(e.template[i[s].type]);void 0!==i[s].title&&n.find(".tourmaster-html-option-group-discount-input-title").html(i[s].title),n.find("[data-tabs-slug]").attr("data-tabs-slug",s),void 0!==i[s].description&&n.append(t('<div class="tourmaster-html-option-group-discount-description-content" ></div>').html(i[s].description)),o.append(n)}e.item_template.append(o),e.item_template.append('<div class="tourmaster-html-option-group-discount-remove"></div>'),e.init()};i.prototype={init:function(){var a=this;if(a.container.append(a.tabs_container),a.container.closest(".tourmaster-html-option-item-input").siblings(".tourmaster-html-option-item-title").append(a.add_button),a.values&&a.values.length>0)for(var e in a.values)a.tabs_container.append(a.get_template(a.values[e]));a.tabs_container.sortable({tolerance:"pointer",delay:150,stop:function(t,e){a.update_data()}}),a.bind_add(),a.container.on("click",".tourmaster-html-option-group-discount-remove",function(){t(this).closest(".tourmaster-html-option-group-discount-template").slideUp(200,function(){t(this).remove(),a.update_data()})}),a.container.on("input change",'input[type="text"]',tourmaster_debounce(function(){a.update_data()},500))},bind_add:function(){var t=this;t.add_button.click(function(){var a=t.get_template();t.tabs_container.append(a),a.find(".tourmaster-html-option-group-discount-template-content").css({display:"block"}),a.css({display:"none"}).slideDown(200),t.update_data()})},get_template:function(a){var e=this.item_template.clone();for(var i in a)e.find('[data-tabs-slug="'+i+'"]').each(function(){t(this).val(a[i])});return e},update_data:function(){var a=this;a.values=[],a.tabs_container.find(".tourmaster-html-option-group-discount-template").each(function(){var e={};t(this).find("[data-tabs-slug]").each(function(){e[t(this).attr("data-tabs-slug")]=t(this).val()}),a.values.push(e)}),a.container.data("value",a.values)}}}(jQuery);